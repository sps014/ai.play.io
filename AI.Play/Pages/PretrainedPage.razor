@page "/pre"
@inject HttpClient Http
<br />
<div class="container">
    <div class="row">
        <div class="col-md-1">
            <div class="card" style="width:500px;height:500px">
                    <div class="card-body">
                         @if(imageToClassify is not null)
                         {
                                  <img src="@imageToClassify" @ref="imageRef" style="width:400px;height:400px" />
                         }
                          <span class="btn btn-primary btn-file">
              Predict      <InputFile OnChange="OnInputFileChange" />
          </span>
                    </div>
                </div>
            </div>
        </div>
        
    </div>



@code 
{
    string imageToClassify;
    ElementReference imageRef;
    Dictionary<string, string> predDict=new Dictionary<string, string>();

    protected override Task OnInitializedAsync()
    {
        LoadData();
        return base.OnInitializedAsync();
    }
    async void LoadData()
    {
        var data =  await Http.GetFromJsonAsync<Rec[]>("/kv.meta");
        foreach(var v in data)
        {
            predDict.Add(v.Id,v.Prediction);
        }
    }
    async Task OnInputFileChange(InputFileChangeEventArgs e)
    {
        var imageFiles = e.GetMultipleFiles();

        var format = "image/png";
        foreach (var imageFile in imageFiles)
        {
            var resizedImageFile = await imageFile.RequestImageFileAsync(format, 300, 300);
            var buffer = new byte[resizedImageFile.Size];
            await resizedImageFile.OpenReadStream().ReadAsync(buffer);
            imageToClassify = $"data:{format};base64,{Convert.ToBase64String(buffer)}";
            var name = imageFile.Name;
        }

            StateHasChanged();

            //if (imageToClassify != null)
                //await Classify();
        }

        record  Rec(string Id,string Prediction);
}

<style>
    body {
        background: #E8EAED;
    }
</style>